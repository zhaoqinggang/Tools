
from sentence_transformers import SentenceTransformer
import os
import torch
from time import time


class pred_frame:
    def __init__(self, model_name_or_path):
        self.device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
        self.model = SentenceTransformer(model_name_or_path)
        self.model.to(self.device)
        self.model.eval()
        self.model_name = model_name_or_path        
        
    def predict(self, params):
        text = params.get('input', [""])
        embeddings = self.model.encode(text, normalize_embeddings=True).tolist()
           
        result = {"embeddings": embeddings}
        
        return result

def init(params):
    cur_path = os.path.dirname(__file__)
    model_name_or_path = cur_path + '/algorithm/checkpoint-180'
    model = pred_frame(model_name_or_path)
    result = model.predict({"text": "怎么还车"})
    return model


if __name__ == "__main__":
    params = None
    model = init(params)
    result = model.predict({"text": "怎么还车"})

    print(result)
    print(model.device)
    # 检查参数的设备信息
    for param in model.model.parameters():
        print(f"Model parameter device: {param.device}")
        break  
